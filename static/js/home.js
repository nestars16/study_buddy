(()=>{"use strict";var e={},t={};function n(o){var d=t[o];if(void 0!==d)return d.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,n),l.exports}async function o(e,t){try{let n=await fetch("/save",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({document_id:e,text:t})});if(200!=n.status){open_external_error_modal(n,await n.text());return}}catch(e){open_external_error_modal(null,e)}}async function d(e){try{let t=await fetch(`/delete_document?document_id=${e}`,{method:"DELETE",credentials:"include"});if(200!=t.status){open_external_error_modal(t,await t.text());return}}catch(e){open_external_error_modal(null,e)}}function l(e,t){window.requestAnimationFrame(()=>{let n=hljs.highlight(e.value,{language:"markdown"}).value;t.innerHTML=n})}function a(e){if(!!e)window.requestAnimationFrame(()=>{e.style.height=0,e.scrollHeight>0&&(e.style.height=`${e.scrollHeight+2}px`)})}function c(e){"Tab"===e.key&&(e.preventDefault(),editor.setRangeText("  ",editor.selectionStart,editor.selectionStart,"end"))}function i(e){let t=document.querySelector(".line-numbers"),n=e.target.value.split("\n").length;t.innerHTML=Array(n).fill("<span></span>").join("")}function s(){document.getElementById("user-document-title-modal").close()}function m(){document.getElementById("user-document-title-modal").showModal()}function r(e){let t=document.getElementById("user-modal");t.showModal(),document.getElementById("user-modal-title").textContent=e;let n=document.getElementById("remember-me"),o=document.getElementById("forgot-password");switch(e){case"Register":document.getElementById("password-confirmation-field").classList.remove("hidden"),n.classList.add("hidden"),o.classList.add("hidden");break;case"Log In":document.getElementById("toggle-switch").classList.remove("hidden"),n.classList.remove("hidden"),o.classList.remove("hidden")}t.classList.remove("hidden")}function u(){let e=document.getElementById("user-modal");document.getElementById("password-confirmation-field").classList.add("hidden"),e.close(),document.getElementById("toggle-switch").classList.add("hidden"),document.getElementById("remember-me").classList.add("hidden"),document.getElementById("forgot-password").classList.add("hidden")}function g(){document.getElementById("error-modal").close()}function y(){document.getElementById("all-documents-modal").close()}n.rv=function(){return"1.0.0"},n.ruid="bundler=rspack@1.0.0";let h=null;async function f(e,t,n){h&&clearInterval(h);let{document_id:d,title:l}=n[e.target.id];document.getElementById("document-title").innerText=l;let a=document.getElementById("editor"),c=await t(d);a.value=c,document.getElementById("editor").dispatchEvent(new Event("input",{bubbles:!0})),document.getElementById("document-close-button").click(),h=setInterval(()=>{o(d,document.getElementById("editor").value)},6e4)}async function E(e,t,n){let{document_id:o}=n[e.target.parentElement.id];await t(o)}function I(e,t){let n;switch(t){case"light":n="black";break;case"dark":n="#FAFAFA"}e.style.borderTopColor=n,e.disabled=!0,e.classList.add("loading-button")}function B(e){e.disabled=!1,e.classList.remove("loading-button")}function p(e){e.classList.add("error-shake-modal")}async function w(e,t){try{let n=await fetch("/download",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({html:e,css:t})});if(200!=n.status){T(n,await n.text());return}let o=await n.json(),d=document.createElement("a");d.href=o.data.url,d.download=o.data.url,d.target="_blank",d.click();let l=document.getElementById("download");B(l)}catch(e){T(null,e)}}async function b(e,t,n){let o=document.getElementById("modal-error");try{let d=await fetch("/log_in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,wants_to_be_remembered:n})});if(200!=d.status){let e=await d.text();p(document.getElementById("user-modal")),B(document.getElementById("submit-button")),o.textContent=e;return}}catch(e){T(null,e)}location.reload()}async function L(e,t,n){let o=document.getElementById("modal-error");if(!t.match(/(?=.*[A-Za-z])(?=.*\d).{8,}$/)){o.textContent="Password must contain minimum eight characters\nat least one letter and one number",B(document.getElementById("submit-button")),p(document.getElementById("user-modal"));return}if(t!==n){o.textContent="Passwords dont match",B(document.getElementById("submit-button")),p(document.getElementById("user-modal"));return}try{let n=await fetch("/create_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(201!=n.status){let e=await n.text();B(document.getElementById("submit-button")),p(document.getElementById("user-modal")),o.textContent=e;return}location.reload()}catch(e){T(null,e)}}async function v(){document.getElementById("modal-error").textContent="";let e=document.querySelector(".user-modal-title").textContent,t=document.getElementById("email-field").value,n=document.getElementById("password-field").value,o=document.getElementById("modal-error"),d=!(t&&n);switch(e){case"Log In":let l=document.querySelector(".toggle__input").checked;if(d){o.textContent="All fields are required",B(document.getElementById("submit-button")),p(document.getElementById("user-modal"));return}await b(t,n,l);break;case"Register":let a=document.getElementById("password-confirmation-field").value;if(d||!a){o.textContent="All fields are required",p(document.getElementById("user-modal")),B(document.getElementById("submit-button"));return}await L(t,n,a)}B(document.getElementById("submit-button"))}async function k(){try{let e=await fetch("/log_out",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(200!=e.status){T(e,await e.text()),B(document.getElementById("log-out"));return}location.reload()}catch(e){B(document.getElementById("log-out")),T(null,e)}}async function x(e){try{let t=await fetch("/create_document",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e})});if(200!=t.status){document.getElementById("user-document-title-modal").classList.add("hidden"),document.querySelector(".overlay").classList.remove("hidden"),T(t,await t.text());return}let n=await t.json();console.log(n),document.getElementById("document-title").textContent=e}catch(e){T(null,e)}s(),B(document.getElementById("document-title-submit"))}async function _(){try{let e=await fetch("/fetch_documents",{method:"GET",credentials:"include"});if(200!=e.status){T(e,await e.text());return}return await e.json()}catch(e){T(null,e)}}async function C(e){let t=`/fetch_content?document_id=${e}`;try{let e=await fetch(t,{method:"GET",credentials:"include"});if(200!=e.status){T(e,await e.text());return}return await e.json()}catch(e){T(null,e)}}function T(e,t){!e&&(e.status="No status code"),document.getElementById("error-modal").show(),document.getElementById("error-message").textContent=`Error code : ${e.status} - ${t}`}let S="dark",q=0,O=document.getElementById("highlight"),j=document.getElementById("editor");j.textContent="";let A=document.getElementById("markdown-display"),$=[],M=10,N=new URL("/refresh",window.location.href);N.protocol=N.protocol.replace("http","ws");let P=new WebSocket(N.href);(function e(){function t(){if(q>=5){console.error("Max reconnection attempts reached. Could not reconnect.");return}++q,setTimeout(()=>{P=new WebSocket(N.href),e()},2e3)}P.onmessage=e=>{A.innerHTML=e.data},P.onopen=()=>{P.send(j.value),q=0},P.onerror=e=>{console.error(`Connection error: ${JSON.stringify(e)}`),t()},P.onclose=()=>{console.error("Connection closed"),t()}})();async function H(){let e=document.getElementById("toggle-modes"),t=document.getElementById("download"),n=document.getElementById("sign-up"),o=document.getElementById("log-in"),h=document.getElementById("submit-button"),B=document.getElementById("log-out"),p=document.getElementById("add-document"),b=document.getElementById("document-title-submit"),L=document.getElementById("document-title-form"),T=document.getElementById("all-documents"),q=document.getElementById("error-modal-close");document.getElementById("forgot-password").onclick=()=>{u()};let N=document.getElementById("document-close-button"),H=document.getElementById("user-document-title-close"),J=document.getElementById("user-modal-close"),D=document.getElementById("user-modal");J.onclick=u,q.onclick=g,N.onclick=y,H.onclick=s,D.addEventListener("animationend",()=>{setTimeout(()=>{D.classList.remove("error-shake-modal")},200)}),T.onclick=async()=>{!function(){let e=document.querySelector(".overlay");e.classList.remove("hidden"),e.classList.add("loading-overlay")}(),$=await _(),!function(){let e=document.querySelector(".overlay");e.classList.add("hidden"),e.classList.remove("loading-overlay")}(),!function(e,t,n){let o=document.getElementById("document-section");for(let[l,a]of(o.innerHTML="",e.entries())){let c;let i=document.createElement("a"),s=document.createElement("button");switch(s.textContent="\uD83D\uDDD1️",s.classList.add("button-delete"),i.href="#",i.id=l,t){case"dark":c="dark-mode-document-link";break;case"light":c="light-mode-document-link"}i.classList.add(c),i.onclick=t=>{f(t,n,e)},s.onclick=t=>{E(t,d,e),y()},i.innerText=a.title,i.appendChild(s),o.appendChild(i),l!==e.length-1&&o.appendChild(document.createElement("hr"))}document.getElementById("all-documents-modal").showModal(),0===e.length&&(o.innerText="You have no documents, try creating some with the plus icon \uD83E\uDD13")}($,S,C)},p.onclick=m,L.onsubmit=e=>{e.preventDefault()},b.onclick=async()=>{if(!!document.getElementById("document-title-field").value)I(b,S),await x(document.getElementById("document-title-field").value)},h.onclick=async e=>{e.preventDefault(),I(h,S),h.disabled=!0,await v()},e.onclick=()=>{S=function(){let e=document.querySelector("body"),t="",n=(e,t,n)=>{n.classList.contains(e)?(n.classList.remove(e),n.classList.add(t)):(n.classList.remove(t),n.classList.add(e))};for(let o of(e.classList.contains("dark-mode-body")?(e.classList.remove("dark-mode-body"),e.classList.add("light-mode-body"),t="light"):(e.classList.remove("light-mode-body"),e.classList.add("dark-mode-body"),t="dark"),document.querySelectorAll(".user-modal-title")))n("dark-user-modal-title","light-user-modal-title",o);for(let e of document.querySelectorAll(".modal"))n("dark-mode-modal","light-mode-modal",e);for(let e of document.querySelectorAll(".action-button")){if("all-documents"!==e.id)n("dark-mode-button","light-mode-button",e)}for(let e of[document.getElementById("email-field"),document.getElementById("password-field"),document.getElementById("password-confirmation-field"),document.getElementById("document-title-field")])n("dark-mode-text-field","light-mode-text-field",e);n("dark-mode-input","light-mode-input",document.getElementById("editor"));let o=document.getElementById("toggle-modes"),d=document.getElementById("moon"),l=document.getElementById("sun");return o.classList.contains("dark-mode-toggle")?(o.classList.remove("dark-mode-toggle"),o.classList.add("light-mode-toggle"),d.classList.add("hidden"),l.classList.remove("hidden")):(o.classList.remove("light-mode-toggle"),o.classList.add("dark-mode-toggle"),l.classList.add("hidden"),d.classList.remove("hidden")),t}(S)},B.onclick=async()=>{I(B,S),await k()},n.onclick=()=>{r("Register")},o.onclick=()=>{r("Log In")},j.setAttribute("data-initialized",!0),j.oninput=()=>{l(j,O),P.send(j.value),a(j),M+=1},j.onkeyup=i,j.onkeydown=c,t.onclick=async()=>{I(t,S),await w(A.innerHTML,S)},a(j)}document.addEventListener("DOMContentLoaded",()=>{a(j),l(j,l),H(),!function(){let e=document.cookie.split("; ").reduce((e,t)=>{let[n,...o]=t.split("=");return e[n]=o.join("="),e},{});document.getElementById("log-out").classList.add("hidden"),document.getElementById("add-document").classList.add("hidden"),document.getElementById("all-documents").classList.add("hidden"),e.session_id&&(document.getElementById("sign-up").classList.add("hidden"),document.getElementById("log-in").classList.add("hidden"),document.getElementById("log-out").classList.remove("hidden"),document.getElementById("add-document").classList.remove("hidden"),document.getElementById("all-documents").classList.remove("hidden"))}(),setInterval(()=>{0===M&&renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1}),M>0&&(M-=1)},150)})})();
//# sourceMappingURL=home.js.map